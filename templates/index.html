<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Health Monitoring Dashboard</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        />
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

        <link
            rel="stylesheet"
            href="{{ url_for('static', filename='css/style.css') }}"
        />
    </head>
    <body class="bg-slate-100 font-sans text-slate-800">
        <div class="flex min-h-screen">
            <aside
                class="w-20 bg-[#18181B] text-white flex flex-col items-center py-6 space-y-8"
            >
                <div class="text-2xl font-bold">M</div>
                <a href="#" class="p-3 bg-gray-700/50 rounded-lg"
                    ><i class="fas fa-home"></i
                ></a>
                <a href="#" class="p-3 hover:bg-gray-700/50 rounded-lg"
                    ><i class="fas fa-chart-bar"></i
                ></a>
                <a href="#" class="p-3 hover:bg-gray-700/50 rounded-lg"
                    ><i class="fas fa-cogs"></i
                ></a>
                <a href="#" class="p-3 hover:bg-gray-700/50 rounded-lg"
                    ><i class="fas fa-user-friends"></i
                ></a>
                <a href="#" class="p-3 hover:bg-gray-700/50 rounded-lg"
                    ><i class="fas fa-life-ring"></i
                ></a>
                <div class="flex-grow"></div>
                <a href="#" class="p-3 hover:bg-gray-700/50 rounded-lg"
                    ><i class="fas fa-user-circle"></i
                ></a>
            </aside>

            <main class="flex-1 p-6 lg:p-10">
                <header
                    class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8"
                >
                    <div class="flex items-center gap-4">
                        <h1 class="text-4xl font-bold text-slate-900">
                            Health Dashboard
                        </h1>
                        <span
                            id="sync-status"
                            class="text-sm text-slate-500 pt-2"
                        ></span>
                    </div>
                    <button
                        id="connect-btn"
                        class="mt-4 md:mt-0 w-full md:w-auto flex items-center justify-center gap-2 bg-white text-slate-800 font-semibold py-2 px-5 rounded-lg shadow-md hover:bg-slate-200 transition-all duration-300 ease-in-out"
                    >
                        <i class="fas fa-satellite-dish text-blue-500"></i>
                        <span>Connect to Device</span>
                    </button>
                </header>

                <section
                    id="date-range-selector"
                    class="mb-6 p-4 bg-white rounded-xl shadow-lg flex-wrap flex items-end gap-4 hidden"
                >
                    <div class="flex-1 min-w-[200px]">
                        <label
                            for="start-time"
                            class="block text-sm font-medium text-slate-700"
                            >Start Time</label
                        >
                        <input
                            type="datetime-local"
                            id="start-time"
                            class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
                        />
                    </div>
                    <div class="flex-1 min-w-[200px]">
                        <label
                            for="end-time"
                            class="block text-sm font-medium text-slate-700"
                            >End Time</label
                        >
                        <input
                            type="datetime-local"
                            id="end-time"
                            class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
                        />
                    </div>
                    <button
                        id="load-history-btn"
                        class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700"
                    >
                        Load Range
                    </button>
                    <button
                        id="go-live-btn"
                        class="bg-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-700 hidden"
                    >
                        Go Live
                    </button>
                </section>

                <div id="data-display-area" class="hidden space-y-8">
                    <section class="bg-white p-6 rounded-xl shadow-lg">
                        <div
                            id="raw-data-header"
                            class="flex justify-between items-center cursor-pointer"
                        >
                            <h2 class="text-xl font-semibold">
                                Live Data Point
                            </h2>
                            <i
                                id="toggle-icon"
                                class="fas fa-chevron-down transition-transform"
                            ></i>
                        </div>
                        <div
                            id="raw-data-content"
                            class="mt-4 transition-all duration-500 ease-in-out overflow-hidden max-h-0"
                        >
                            <p class="text-sm text-slate-500 mb-2">
                                The latest complete data record from Firebase.
                            </p>
                            <div
                                class="bg-slate-900 text-white font-mono text-xs p-4 rounded-lg h-64 overflow-y-auto custom-scrollbar"
                            >
                                <pre
                                    id="raw-data-log"
                                    class="whitespace-pre-wrap"
                                ></pre>
                            </div>
                        </div>
                    </section>

                    <section class="bg-white p-6 rounded-xl shadow-lg">
                        <h2
                            id="data-stream-title"
                            class="text-xl font-semibold mb-3"
                        >
                            Data Stream
                        </h2>
                        <div class="overflow-x-auto custom-scrollbar">
                            <table class="w-full text-left">
                                <thead>
                                    <tr class="border-b bg-slate-50 text-xs">
                                        <th
                                            class="p-2 whitespace-nowrap sticky left-0 bg-slate-50"
                                        >
                                            Timestamp
                                        </th>
                                        <th class="p-2 whitespace-nowrap">
                                            HR
                                        </th>
                                        <th class="p-2 whitespace-nowrap">
                                            IBI
                                        </th>
                                        <th class="p-2 whitespace-nowrap">
                                            SpO2
                                        </th>
                                        <th class="p-2 whitespace-nowrap">
                                            Skin Temp
                                        </th>
                                        <th class="p-2 whitespace-nowrap">
                                            EDA
                                        </th>
                                        <th class="p-2 whitespace-nowrap">
                                            ECG
                                        </th>
                                        <th class="p-2 whitespace-nowrap">
                                            BVP
                                        </th>
                                        <th class="p-2 whitespace-nowrap">
                                            PPG Green
                                        </th>
                                        <th class="p-2 whitespace-nowrap">
                                            PPG Red
                                        </th>
                                        <th class="p-2 whitespace-nowrap">
                                            PPG IR
                                        </th>
                                        <th class="p-2 whitespace-nowrap">
                                            Resp. Rate
                                        </th>
                                        <th class="p-2 whitespace-nowrap">
                                            Acc X
                                        </th>
                                        <th class="p-2 whitespace-nowrap">
                                            Acc Y
                                        </th>
                                        <th class="p-2 whitespace-nowrap">
                                            Acc Z
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="transformed-data-body"></tbody>
                            </table>
                        </div>
                    </section>

                    <section class="bg-white p-6 rounded-xl shadow-lg">
                        <div
                            id="plot-section-header"
                            class="flex justify-between items-center cursor-pointer"
                        >
                            <h2
                                id="plot-section-title"
                                class="text-xl font-semibold"
                            >
                                Feature Plots
                            </h2>
                            <i
                                id="plot-toggle-icon"
                                class="fas fa-chevron-down transition-transform"
                            ></i>
                        </div>
                        <div
                            id="plot-section-content"
                            class="mt-4 transition-all duration-500 ease-in-out overflow-hidden max-h-0"
                        >
                            <div
                                class="grid grid-cols-1 gap-6"
                            >

                                <div class="bg-slate-50 p-4 rounded-lg shadow-inner">
                                    <h3 class="font-semibold text-center text-lg text-slate-700 mb-3">
                                        Heart Rate (hr)
                                    </h3>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div class="md:col-span-2 h-64 relative">
                                            <canvas id="hr-chart"></canvas>
                                        </div>
                                        <div class="md:col-span-1 p-4 bg-white rounded-lg">
                                            <h4 class="font-semibold text-slate-600 border-b pb-2 mb-3">Summary Statistics</h4>
                                            <div class="space-y-3">
                                                <div>
                                                    <span class="text-sm text-slate-500 block">Current</span>
                                                    <span id="hr-stat-current" class="text-2xl font-bold text-blue-600">---</span>
                                                </div>
                                                <div>
                                                    <span class="text-sm text-slate-500 block">Mean</span>
                                                    <span id="hr-stat-mean" class="text-lg font-medium text-slate-800">---</span>
                                                </div>
                                                <div>
                                                    <span class="text-sm text-slate-500 block">Min</span>
                                                    <span id="hr-stat-min" class="text-lg font-medium text-slate-800">---</span>
                                                </div>
                                                <div>
                                                    <span class="text-sm text-slate-500 block">Max</span>
                                                    <span id="hr-stat-max" class="text-lg font-medium text-slate-800">---</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-slate-50 p-4 rounded-lg shadow-inner">
                                    <h3 class="font-semibold text-center text-lg text-slate-700 mb-3">
                                        Inter-Beat Interval (ibi)
                                    </h3>
                                    <div class="h-64 relative">
                                        <canvas id="ibi-chart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="bg-slate-50 p-4 rounded-lg shadow-inner">
                                    <h3 class="font-semibold text-center text-lg text-slate-700 mb-3">
                                        Blood Oxygen (spo2)
                                    </h3>
                                    <div class="h-64 relative">
                                        <canvas id="spo2-chart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="bg-slate-50 p-4 rounded-lg shadow-inner">
                                    <h3 class="font-semibold text-center text-lg text-slate-700 mb-3">
                                        Skin Temp (skinTemp)
                                    </h3>
                                    <div class="h-64 relative">
                                        <canvas id="skinTemp-chart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="bg-slate-50 p-4 rounded-lg shadow-inner">
                                    <h3 class="font-semibold text-center text-lg text-slate-700 mb-3">
                                        Electrodermal Activity (eda)
                                    </h3>
                                    <div class="h-64 relative">
                                        <canvas id="eda-chart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="bg-slate-50 p-4 rounded-lg shadow-inner">
                                    <h3 class="font-semibold text-center text-lg text-slate-700 mb-3">
                                        Electrocardiogram (ecg)
                                    </h3>
                                    <div class="h-64 relative">
                                        <canvas id="ecg-chart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="bg-slate-50 p-4 rounded-lg shadow-inner">
                                    <h3 class="font-semibold text-center text-lg text-slate-700 mb-3">
                                        Blood Volume Pulse (bvp)
                                    </h3>
                                    <div class="h-64 relative">
                                        <canvas id="bvp-chart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="bg-slate-50 p-4 rounded-lg shadow-inner">
                                    <h3 class="font-semibold text-center text-lg text-slate-700 mb-3">
                                        PPG Green
                                    </h3>
                                    <div class="h-64 relative">
                                        <canvas id="ppgGreen-chart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="bg-slate-50 p-4 rounded-lg shadow-inner">
                                    <h3 class="font-semibold text-center text-lg text-slate-700 mb-3">
                                        PPG Red
                                    </h3>
                                    <div class="h-64 relative">
                                        <canvas id="ppgRed-chart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="bg-slate-50 p-4 rounded-lg shadow-inner">
                                    <h3 class="font-semibold text-center text-lg text-slate-700 mb-3">
                                        PPG IR
                                    </h3>
                                    <div class="h-64 relative">
                                        <canvas id="ppgIr-chart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="bg-slate-50 p-4 rounded-lg shadow-inner">
                                    <h3 class="font-semibold text-center text-lg text-slate-700 mb-3">
                                        Respiration Rate (respirationRate)
                                    </h3>
                                    <div class="h-64 relative">
                                        <canvas id="respirationRate-chart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="bg-slate-50 p-4 rounded-lg shadow-inner">
                                    <h3 class="font-semibold text-center text-lg text-slate-700 mb-3">
                                        Accelerometer X (accX)
                                    </h3>
                                    <div class="h-64 relative">
                                        <canvas id="accX-chart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="bg-slate-50 p-4 rounded-lg shadow-inner">
                                    <h3 class="font-semibold text-center text-lg text-slate-700 mb-3">
                                        Accelerometer Y (accY)
                                    </h3>
                                    <div class="h-64 relative">
                                        <canvas id="accY-chart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="bg-slate-50 p-4 rounded-lg shadow-inner">
                                    <h3 class="font-semibold text-center text-lg text-slate-700 mb-3">
                                        Accelerometer Z (accZ)
                                    </h3>
                                    <div class="h-64 relative">
                                        <canvas id="accZ-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section>
                        <h2 class="text-xl font-semibold mb-4">
                            Model Health Scores
                        </h2>
                        <div
                            class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6"
                            id="models-grid"
                        ></div>
                    </section>

                    <!-- Model Scores Dashboard Section -->
                    <section class="bg-white p-6 rounded-xl shadow-lg">
                        
                        <h2 class="text-xl font-semibold mb-3">
                            Health Score Log (Live Mode)
                        </h2>
                        <h2 class="text-xl font-semibold mb-4">
                            Model Scores (30-Second Averages from Firebase)
                        </h2>
                    
                        <!-- Scores Cards -->
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-6">
                            <div class="bg-blue-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-blue-600 mb-1" id="model-sqi">--</div>
                                <div class="text-sm text-blue-800 font-medium">Sleep Quality</div>
                            </div>
                            <div class="bg-red-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-red-600 mb-1" id="model-psi">--</div>
                                <div class="text-sm text-red-800 font-medium">Stress Index</div>
                            </div>
                            <div class="bg-yellow-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-yellow-600 mb-1" id="model-cls">--</div>
                                <div class="text-sm text-yellow-800 font-medium">Cognitive Load</div>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-green-600 mb-1" id="model-cvhs">--</div>
                                <div class="text-sm text-green-800 font-medium">Cardio Health</div>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-purple-600 mb-1" id="model-evs">--</div>
                                <div class="text-sm text-purple-800 font-medium">Emotional Vitality</div>
                            </div>
                        </div>

                        <!-- Controls -->
                        <div class="flex space-x-4 mb-4">
                            <button onclick="fetchModelScores()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 text-sm">
                                Refresh Model Scores
                            </button>
                            <button onclick="fetchModelScoresHistorical()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 text-sm">
                                Load Historical Scores
                            </button>
                        </div>

                        <!-- Historical Scores Table -->
                        <div class="overflow-x-auto h-72 custom-scrollbar">
                            <table class="w-full text-left">
                                <thead>
                                    <tr 
                                        class="border-b bg-slate-50 sticky top-0"
                                    >
                                    <th class="p-3">Timestamp</th>
                                    <th class="p-3">Sleep Quality</th>
                                    <th class="p-3">
                                        Psychosomatic Stress
                                    </th>
                                    <th class="p-3">Cognitive Load</th>
                                    <th class="p-3">
                                        Cardiovascular Health
                                    </th>
                                    <th class="p-3">Emotional Vitality</th>
                                    </tr>
                                </thead>
                                <tbody id="score-log-body"></tbody>                                 
                                
                            </table>
                        </div>
                    </section>                                        
                    </div>
                    <div id="initial-message" class="text-center py-20">
                        <i
                            class="fas fa-power-off text-6xl text-slate-300 mb-4"
                        ></i>
                        <h2 class="text-2xl font-semibold text-slate-600">
                            Device Disconnected
                        </h2>
                        <p class="text-slate-500">
                            Please connect to a device to start monitoring.
                        </class=>
                    </div>
                </main>
            </div>

            <script
                type="module"
                src="{{ url_for('static', filename='js/main.js') }}"
            ></script>
        </body>
    </html>
